import{_ as e,l as n,k as t,p as a,ak as o,a1 as i,s,r,a as l,c as d,w as c,y as p,e as u,o as f,b as h,d as g,f as m,P as w}from"./index-BmzQcWuq.js";const y=e({data:()=>({title:"request-payment",loading:!1,price:1,providerList:[]}),onLoad:function(){},methods:{loginMpWeixin:()=>new Promise(((e,o)=>{n({provider:"weixin",success(n){console.warn("此处使用uni-id处理微信小程序登录，详情参考: https://uniapp.dcloud.net.cn/uniCloud/uni-id"),t({url:"https://97fca9f2-41f6-449f-a35e-3f135d4c3875.bspapp.com/http/user-center",method:"POST",data:{action:"loginByWeixin",params:{code:n.code,platform:"mp-weixin"}},success(n){0===n.data.code?(a("openid",n.data.openid),e(n.data.openid)):o(new Error("获取openid失败：",n.result.msg))},fail(e){o(new Error("获取openid失败："+e))}})},fail(e){o(e)}})})),async weixinPay(){let e=o("openid");if(console.log("发起支付"),this.loading=!0,!e){try{e=await this.loginMpWeixin()}catch(t){console.error(t)}if(!e)return i({content:"获取openid失败",showCancel:!1}),void(this.loading=!1)}this.openid=e;let n=await this.getOrderInfo("wxpay");n?uni.requestPayment({...n,success:e=>{s({title:"感谢您的赞助!"})},fail:e=>{i({content:"支付失败,原因为: "+e.errMsg,showCancel:!1})},complete:()=>{this.loading=!1}}):i({content:"获取支付信息失败",showCancel:!1})},async requestPayment(e,n){this.providerList[n].loading=!0;const t=e.id;let a=await this.getOrderInfo(t);a?(console.log("--------orderInfo--------"),console.log(a),uni.requestPayment({provider:t,orderInfo:a,success:e=>{console.log("success",e),s({title:"感谢您的赞助!"})},fail:e=>{console.log("fail",e),i({content:"支付失败,原因为: "+e.errMsg,showCancel:!1})},complete:()=>{this.providerList[n].loading=!1}})):i({content:"获取支付信息失败",showCancel:!1})},getOrderInfo(e){return new Promise(((n,a)=>{this.price||a(new Error("请输入金额")),console.warn("此处使用uni-pay处理支付，详情参考: https://uniapp.dcloud.io/uniCloud/unipay"),t({method:"POST",url:"https://97fca9f2-41f6-449f-a35e-3f135d4c3875.bspapp.com/http/pay",data:{provider:e,openid:this.openid,totalFee:100*Number(this.price)},success(e){0===e.data.code?n(e.data.orderInfo):a(new Error("获取支付信息失败"+e.data.msg))},fail(e){a(new Error("请求支付接口失败"+e))}})}))},priceChange(e){console.log(e.detail.value),this.price=e.detail.value}}},[["render",function(e,n,t,a,o,i){const s=r(l("page-head"),p),y=m,v=u,x=w;return f(),d(v,null,{default:c((()=>[h(s,{title:o.title},null,8,["title"]),h(v,{class:"uni-padding-wrap"},{default:c((()=>[h(v,{style:{background:"#FFF",padding:"50rpx 0"}},{default:c((()=>[h(v,{class:"uni-hello-text uni-center"},{default:c((()=>[h(y,null,{default:c((()=>[g("支付金额")])),_:1})])),_:1}),h(v,{class:"uni-h1 uni-center uni-common-mt"},{default:c((()=>[h(y,{class:"rmbLogo"},{default:c((()=>[g("￥")])),_:1}),h(x,{class:"price",type:"digit",value:o.price,maxlength:"4",onInput:i.priceChange},null,8,["value","onInput"])])),_:1})])),_:1}),h(v,{class:"uni-btn-v uni-common-mt"})])),_:1})])),_:1})}],["__scopeId","data-v-97e3fe02"]]);export{y as default};
